{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the AI Resume Tailor application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "createdAt"
      ]
    },
    "TailoredResume": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TailoredResume",
      "type": "object",
      "description": "Represents a tailored resume generated by the AI Resume Tailor application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the tailored resume entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who created this tailored resume. (Relationship: User 1:N TailoredResume)"
        },
        "resumeOriginal": {
          "type": "string",
          "description": "Original resume text provided by the user."
        },
        "jobDescription": {
          "type": "string",
          "description": "Job description used for tailoring the resume."
        },
        "language": {
          "type": "string",
          "description": "Language of the resume and job description (e.g., EN, RU, KZ)."
        },
        "tailoredResumeMd": {
          "type": "string",
          "description": "Tailored resume in Markdown format."
        },
        "changeLog": {
          "type": "array",
          "description": "List of changes made to the original resume during tailoring.",
          "items": {
            "type": "string"
          }
        },
        "matchScore": {
          "type": "number",
          "description": "Match score indicating the relevance of the tailored resume to the job description (0-100)."
        },
        "scoreRationale": {
          "type": "string",
          "description": "Rationale behind the match score."
        },
        "promptVersion": {
          "type": "string",
          "description": "Version of the system prompt used for tailoring."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the tailored resume was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "resumeOriginal",
        "jobDescription",
        "language",
        "tailoredResumeMd",
        "changeLog",
        "matchScore",
        "scoreRationale",
        "promptVersion",
        "createdAt"
      ]
    },
    "Prompt": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Prompt",
      "type": "object",
      "description": "Represents a system prompt used by the AI for resume tailoring.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the prompt entity."
        },
        "versionLabel": {
          "type": "string",
          "description": "Version label for the prompt."
        },
        "promptText": {
          "type": "string",
          "description": "The actual system prompt text."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the prompt was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "versionLabel",
        "promptText",
        "createdAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information.  Uses path-based ownership for security.  Only the user can read/write their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/tailoredResumes/{tailoredResumeId}",
        "definition": {
          "entityName": "TailoredResume",
          "schema": {
            "$ref": "#/backend/entities/TailoredResume"
          },
          "description": "Stores tailored resumes generated for each user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "tailoredResumeId",
              "description": "The unique identifier for the tailored resume."
            }
          ]
        }
      },
      {
        "path": "/prompts/{promptId}",
        "definition": {
          "entityName": "Prompt",
          "schema": {
            "$ref": "#/backend/entities/Prompt"
          },
          "description": "Stores system prompts used for resume tailoring. Accessible with appropriate roles. (Global data, version controlled).",
          "params": [
            {
              "name": "promptId",
              "description": "The unique identifier for the prompt."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and ease of debugging, adhering to the principles of Authorization Independence and Structural Segregation. User data and tailored resumes are stored in separate collections to maintain distinct security postures. Authorization independence is achieved by storing the `userId` within each `TailoredResume` document, removing the need for hierarchical `get()` calls in security rules. This supports atomic operations and simplifies debugging. The structure uses path-based ownership for user-specific data, ensuring users can only access their own tailored resumes, thereby supporting the required QAPs. Prompts are stored in a global collection, accessible with appropriate roles, and the structure supports storing a history of prompt versions for iteration and debugging. Overall, this design allows for simple and robust security rules, clear intent, and predictable data access patterns, promoting maintainability and security."
  }
}